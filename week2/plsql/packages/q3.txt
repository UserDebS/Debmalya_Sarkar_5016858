--Question: Create a package AccountOperations with procedures for opening a new account, closing an account, and a function to get the total balance of a customer across all accounts.

CREATE OR REPLACE PACKAGE ACCOUNTOPERATIONS AS

    PROCEDURE OPENACCOUNT(
        P_ACCOUNTID NUMBER,
        P_CUSTOMERID NUMBER,
        P_ACCOUNTTYPE VARCHAR2,
        P_BALANCE NUMBER
    );

    PROCEDURE CLOSEACCOUNT(
        P_ACCOUNTID NUMBER
    );

    FUNCTION GETTOTALBALANCE(
        P_CUSTOMERID NUMBER
    ) RETURN NUMBER;
END ACCOUNTOPERATIONS;
CREATE    OR REPLACE PACKAGE BODY ACCOUNTOPERATIONS AS

PROCEDURE OPENACCOUNT(
    P_ACCOUNTID NUMBER,
    P_CUSTOMERID NUMBER,
    P_ACCOUNTTYPE VARCHAR2,
    P_BALANCE NUMBER
) IS
BEGIN
    INSERT INTO ACCOUNTS (
        ACCOUNTID,
        CUSTOMERID,
        ACCOUNTTYPE,
        BALANCE,
        LASTMODIFIED
    ) VALUES (
        P_ACCOUNTID,
        P_CUSTOMERID,
        P_ACCOUNTTYPE,
        P_BALANCE,
        SYSDATE
    );
EXCEPTION
    WHEN DUP_VAL_ON_INDEX THEN
        RAISE_APPLICATION_ERROR(-20001, 'Account with this ID already exists.');
    WHEN OTHERS THEN
        RAISE_APPLICATION_ERROR(-20002, 'An error occurred while opening the account.');
END OPENACCOUNT;

PROCEDURE CLOSEACCOUNT(
    P_ACCOUNTID NUMBER
) IS
BEGIN
    DELETE FROM ACCOUNTS
    WHERE
        ACCOUNTID = P_ACCOUNTID;
    IF SQL%ROWCOUNT = 0 THEN
        RAISE_APPLICATION_ERROR(-20003, 'Account with this ID does not exist.');
    END IF;
EXCEPTION
    WHEN OTHERS THEN
        RAISE_APPLICATION_ERROR(-20004, 'An error occurred while closing the account.');
END CLOSEACCOUNT;

FUNCTION GETTOTALBALANCE(
    P_CUSTOMERID NUMBER
) RETURN NUMBER IS
    V_TOTALBALANCE NUMBER;
BEGIN
    SELECT
        SUM(BALANCE) INTO V_TOTALBALANCE
    FROM
        ACCOUNTS
    WHERE
        CUSTOMERID = P_CUSTOMERID;
    IF V_TOTALBALANCE IS NULL THEN
        V_TOTALBALANCE := 0;
    END IF;

    RETURN V_TOTALBALANCE;
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN 0;
    WHEN OTHERS THEN
        RAISE_APPLICATION_ERROR(-20005, 'An error occurred while retrieving the total balance.');
END GETTOTALBALANCE;
END ACCOUNTOPERATIONS;